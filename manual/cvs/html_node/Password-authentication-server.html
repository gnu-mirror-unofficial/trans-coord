<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 5.2, http://www.gnu.org/software/texinfo/ -->
<head>
<title>CVS&mdash;Concurrent Versions System v1.11.23: Password authentication server</title>

<meta name="description" content="CVS&mdash;Concurrent Versions System v1.11.23: Password authentication server">
<meta name="keywords" content="CVS&mdash;Concurrent Versions System v1.11.23: Password authentication server">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Password-authenticated.html#Password-authenticated" rel="up" title="Password authenticated">
<link href="Password-authentication-client.html#Password-authentication-client" rel="next" title="Password authentication client">
<link href="Password-authenticated.html#Password-authenticated" rel="prev" title="Password authenticated">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.indentedblock {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smallindentedblock {margin-left: 3.2em; font-size: smaller}
div.smalllisp {margin-left: 3.2em}
kbd {font-style:oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nocodebreak {white-space:nowrap}
span.nolinebreak {white-space:nowrap}
span.roman {font-family:serif; font-weight:normal}
span.sansserif {font-family:sans-serif; font-weight:normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="/software/gnulib/manual.css">


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">
<a name="Password-authentication-server"></a>
<div class="header">
<p>
Next: <a href="Password-authentication-client.html#Password-authentication-client" accesskey="n" rel="next">Password authentication client</a>, Up: <a href="Password-authenticated.html#Password-authenticated" accesskey="u" rel="up">Password authenticated</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="Setting-up-the-server-for-password-authentication"></a>
<h4 class="subsubsection">2.9.3.1 Setting up the server for password authentication</h4>

<p>First of all, you probably want to tighten the
permissions on the <samp>$CVSROOT</samp> and
<samp>$CVSROOT/CVSROOT</samp> directories.  See <a href="Password-authentication-security.html#Password-authentication-security">Password authentication security</a>, for more details.
</p>
<a name="index-pserver-_0028subcommand_0029"></a>
<a name="index-Remote-repositories_002c-port-specification-1"></a>
<a name="index-Repositories_002c-remote_002c-port-specification-1"></a>
<a name="index-Client_002fServer-Operation_002c-port-specification-1"></a>
<a name="index-pserver-_0028client_002fserver-connection-method_0029_002c-port-specification-1"></a>
<a name="index-kserver-_0028client_002fserver-connection-method_0029_002c-port-specification-1"></a>
<a name="index-gserver-_0028client_002fserver-connection-method_0029_002c-port-specification-1"></a>
<a name="index-port_002c-specifying-for-remote-repositories-1"></a>
<a name="index-Password-server_002c-setting-up"></a>
<a name="index-Authenticating-server_002c-setting-up"></a>
<a name="index-inetd_002c-configuring-for-pserver"></a>
<a name="index-xinetd_002c-configuring-for-pserver"></a>
<p>On the server side, the file <samp>/etc/inetd.conf</samp>
needs to be edited so <code>inetd</code> knows to run the
command <code>cvs pserver</code> when it receives a
connection on the right port.  By default, the port
number is 2401; it would be different if your client
were compiled with <code>CVS_AUTH_PORT</code> defined to
something else, though.  This can also be specified in the CVSROOT variable
(see <a href="Remote-repositories.html#Remote-repositories">Remote repositories</a>) or overridden with the CVS_CLIENT_PORT
environment variable (see <a href="Environment-variables.html#Environment-variables">Environment variables</a>).
</p>
<p>If your <code>inetd</code> allows raw port numbers in
<samp>/etc/inetd.conf</samp>, then the following (all on a
single line in <samp>inetd.conf</samp>) should be sufficient:
</p>
<div class="example">
<pre class="example">2401  stream  tcp  nowait  root  /usr/local/bin/cvs
cvs -f --allow-root=/usr/cvsroot pserver
</pre></div>

<p>(You could also use the
&lsquo;<samp>-T</samp>&rsquo; option to specify a temporary directory.)
</p>
<p>The &lsquo;<samp>--allow-root</samp>&rsquo; option specifies the allowable
<small>CVSROOT</small> directory.  Clients which attempt to use a
different <small>CVSROOT</small> directory will not be allowed to
connect.  If there is more than one <small>CVSROOT</small>
directory which you want to allow, repeat the option.
Unfortunately, many versions of <code>inetd</code> have very small
limits on the number of arguments and/or the total length
of the command.  The usual solution to this problem is
to have <code>inetd</code> run a shell script which then invokes
<small>CVS</small> with the necessary arguments:
</p>
<div class="example">
<pre class="example">#! /bin/sh
exec /usr/local/bin/cvs -f \
     --allow-root=/repo1 \
     --allow-root=/repo2 \
     ...
     --allow-root=/repo<var>N</var> \
     pserver
</pre></div>

<p>If your <code>inetd</code> wants a symbolic service
name instead of a raw port number, then put this in
<samp>/etc/services</samp>:
</p>
<div class="example">
<pre class="example">cvspserver      2401/tcp
</pre></div>

<p>and put <code>cvspserver</code> instead of <code>2401</code> in <samp>inetd.conf</samp>.
</p>
<p>If your system uses <code>xinetd</code> instead of <code>inetd</code>,
the procedure is slightly different.
Create a file called <samp>/etc/xinetd.d/cvspserver</samp> containing the following:
</p>
<div class="example">
<pre class="example">service cvspserver
{
   port        = 2401
   socket_type = stream
   protocol    = tcp
   wait        = no
   user        = root
   passenv     = PATH
   server      = /usr/local/bin/cvs
   server_args = -f --allow-root=/usr/cvsroot pserver
}
</pre></div>

<p>(If <code>cvspserver</code> is defined in <samp>/etc/services</samp>, you can omit
the <code>port</code> line.)
</p>
<p>Once the above is taken care of, restart your
<code>inetd</code>, or do whatever is necessary to force it
to reread its initialization files.
</p>
<p>If you are having trouble setting this up, see
<a href="Connection.html#Connection">Connection</a>.
</p>
<a name="index-CVS-passwd-file"></a>
<a name="index-passwd-_0028admin-file_0029"></a>
<p>Because the client stores and transmits passwords in
cleartext (almost&mdash;see <a href="Password-authentication-security.html#Password-authentication-security">Password authentication security</a>, for details), a separate <small>CVS</small> password
file is generally used, so people don&rsquo;t compromise
their regular passwords when they access the
repository.  This file is
<samp>$CVSROOT/CVSROOT/passwd</samp> (see <a href="Intro-administrative-files.html#Intro-administrative-files">Intro administrative files</a>).  It uses a colon-separated
format, similar to <samp>/etc/passwd</samp> on Unix systems,
except that it has fewer fields: <small>CVS</small> username,
optional password, and an optional system username for
<small>CVS</small> to run as if authentication succeeds.  Here is
an example <samp>passwd</samp> file with five entries:
</p>
<div class="example">
<pre class="example">anonymous:
bach:ULtgRLXo7NRxs
spwang:1sOp854gDF3DY
melissa:tGX1fS8sun6rY:pubcvs
qproj:XR4EZcEs0szik:pubcvs
</pre></div>

<p>(The passwords are encrypted according to the standard
Unix <code>crypt()</code> function, so it is possible to
paste in passwords directly from regular Unix
<samp>/etc/passwd</samp> files.)
</p>
<p>The first line in the example will grant access to any
<small>CVS</small> client attempting to authenticate as user
<code>anonymous</code>, no matter what password they use,
including an empty password.  (This is typical for
sites granting anonymous read-only access; for
information on how to do the &quot;read-only&quot; part, see
<a href="Read_002donly-access.html#Read_002donly-access">Read-only access</a>.)
</p>
<p>The second and third lines will grant access to
<code>bach</code> and <code>spwang</code> if they supply their
respective plaintext passwords.
</p>
<a name="index-User-aliases"></a>
<p>The fourth line will grant access to <code>melissa</code>, if
she supplies the correct password, but her <small>CVS</small>
operations will actually run on the server side under
the system user <code>pubcvs</code>.  Thus, there need not be
any system user named <code>melissa</code>, but there
<em>must</em> be one named <code>pubcvs</code>.
</p>
<p>The fifth line shows that system user identities can be
shared: any client who successfully authenticates as
<code>qproj</code> will actually run as <code>pubcvs</code>, just
as <code>melissa</code> does.  That way you could create a
single, shared system user for each project in your
repository, and give each developer their own line in
the <samp>$CVSROOT/CVSROOT/passwd</samp> file.  The <small>CVS</small>
username on each line would be different, but the
system username would be the same.  The reason to have
different <small>CVS</small> usernames is that <small>CVS</small> will log their
actions under those names: when <code>melissa</code> commits
a change to a project, the checkin is recorded in the
project&rsquo;s history under the name <code>melissa</code>, not
<code>pubcvs</code>.  And the reason to have them share a
system username is so that you can arrange permissions
in the relevant area of the repository such that only
that account has write-permission there.
</p>
<p>If the system-user field is present, all
password-authenticated <small>CVS</small> commands run as that
user; if no system user is specified, <small>CVS</small> simply
takes the <small>CVS</small> username as the system username and
runs commands as that user.  In either case, if there
is no such user on the system, then the <small>CVS</small>
operation will fail (regardless of whether the client
supplied a valid password).
</p>
<p>The password and system-user fields can both be omitted
(and if the system-user field is omitted, then also
omit the colon that would have separated it from the
encrypted password).  For example, this would be a
valid <samp>$CVSROOT/CVSROOT/passwd</samp> file:
</p>
<div class="example">
<pre class="example">anonymous::pubcvs
fish:rKa5jzULzmhOo:kfogel
sussman:1sOp854gDF3DY
</pre></div>

<p>When the password field is omitted or empty, then the
client&rsquo;s authentication attempt will succeed with any
password, including the empty string.  However, the
colon after the <small>CVS</small> username is always necessary,
even if the password is empty.
</p>
<p><small>CVS</small> can also fall back to use system authentication.
When authenticating a password, the server first checks
for the user in the <samp>$CVSROOT/CVSROOT/passwd</samp>
file.  If it finds the user, it will use that entry for
authentication as described above.  But if it does not
find the user, or if the <small>CVS</small> <samp>passwd</samp> file
does not exist, then the server can try to authenticate
the username and password using the operating system&rsquo;s
user-lookup routines (this &quot;fallback&quot; behavior can be
disabled by setting <code>SystemAuth=no</code> in the
<small>CVS</small> <samp>config</samp> file, see <a href="config.html#config">config</a>).  Be
aware, however, that falling back to system
authentication might be a security risk: <small>CVS</small>
operations would then be authenticated with that user&rsquo;s
regular login password, and the password flies across
the network in plaintext.  See <a href="Password-authentication-security.html#Password-authentication-security">Password authentication security</a> for more on this.
</p>
<p>Right now, the only way to put a password in the
<small>CVS</small> <samp>passwd</samp> file is to paste it there from
somewhere else.  Someday, there may be a <code>cvs
passwd</code> command.
</p>
<p>Unlike many of the files in <samp>$CVSROOT/CVSROOT</samp>, it
is normal to edit the <samp>passwd</samp> file in-place,
rather than via <small>CVS</small>.  This is because of the
possible security risks of having the <samp>passwd</samp>
file checked out to people&rsquo;s working copies.  If you do
want to include the <samp>passwd</samp> file in checkouts of
<samp>$CVSROOT/CVSROOT</samp>, see <a href="checkoutlist.html#checkoutlist">checkoutlist</a>.
</p>

<hr>
<div class="header">
<p>
Next: <a href="Password-authentication-client.html#Password-authentication-client" accesskey="n" rel="next">Password authentication client</a>, Up: <a href="Password-authenticated.html#Password-authenticated" accesskey="u" rel="up">Password authenticated</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
