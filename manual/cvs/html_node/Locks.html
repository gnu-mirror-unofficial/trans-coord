<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 5.2, http://www.gnu.org/software/texinfo/ -->
<head>
<title>CVS&mdash;Concurrent Versions System v1.11.23: Locks</title>

<meta name="description" content="CVS&mdash;Concurrent Versions System v1.11.23: Locks">
<meta name="keywords" content="CVS&mdash;Concurrent Versions System v1.11.23: Locks">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Repository-storage.html#Repository-storage" rel="up" title="Repository storage">
<link href="CVSROOT-storage.html#CVSROOT-storage" rel="next" title="CVSROOT storage">
<link href="CVS-in-repository.html#CVS-in-repository" rel="prev" title="CVS in repository">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.indentedblock {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smallindentedblock {margin-left: 3.2em; font-size: smaller}
div.smalllisp {margin-left: 3.2em}
kbd {font-style:oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nocodebreak {white-space:nowrap}
span.nolinebreak {white-space:nowrap}
span.roman {font-family:serif; font-weight:normal}
span.sansserif {font-family:sans-serif; font-weight:normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">
<a name="Locks"></a>
<div class="header">
<p>
Next: <a href="CVSROOT-storage.html#CVSROOT-storage" accesskey="n" rel="next">CVSROOT storage</a>, Previous: <a href="CVS-in-repository.html#CVS-in-repository" accesskey="p" rel="prev">CVS in repository</a>, Up: <a href="Repository-storage.html#Repository-storage" accesskey="u" rel="up">Repository storage</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="CVS-locks-in-the-repository"></a>
<h4 class="subsection">2.2.6 CVS locks in the repository</h4>

<a name="index-_0023cvs_002erfl_002c-technical-details"></a>
<a name="index-_0023cvs_002ewfl_002c-technical-details"></a>
<a name="index-_0023cvs_002elock_002c-technical-details"></a>
<a name="index-Locks_002c-cvs_002c-technical-details"></a>
<p>For an introduction to <small>CVS</small> locks focusing on
user-visible behavior, see <a href="Concurrency.html#Concurrency">Concurrency</a>.  The
following section is aimed at people who are writing
tools which want to access a <small>CVS</small> repository without
interfering with other tools accessing the same
repository.  If you find yourself confused by concepts
described here, like <em>read lock</em>, <em>write lock</em>,
and <em>deadlock</em>, you might consult the literature on
operating systems or databases.
</p>
<a name="index-_0023cvs_002etfl"></a>
<p>Any file in the repository with a name starting
with <samp>#cvs.rfl.</samp> is a read lock.  Any file in
the repository with a name starting with
<samp>#cvs.wfl</samp> is a write lock.  Old versions of <small>CVS</small>
(before <small>CVS</small> 1.5) also created files with names starting
with <samp>#cvs.tfl</samp>, but they are not discussed here.
The directory <samp>#cvs.lock</samp> serves as a master
lock.  That is, one must obtain this lock first before
creating any of the other locks.
</p>
<p>To obtain a read lock, first create the <samp>#cvs.lock</samp>
directory.  This operation must be atomic (which should
be true for creating a directory under most operating
systems).  If it fails because the directory already
existed, wait for a while and try again.  After
obtaining the <samp>#cvs.lock</samp> lock, create a file
whose name is <samp>#cvs.rfl.</samp> followed by information
of your choice (for example, hostname and process
identification number).  Then remove the
<samp>#cvs.lock</samp> directory to release the master lock.
Then proceed with reading the repository.  When you are
done, remove the <samp>#cvs.rfl</samp> file to release the
read lock.
</p>
<p>To obtain a write lock, first create the
<samp>#cvs.lock</samp> directory, as with read locks.  Then
check that there are no files whose names start with
<samp>#cvs.rfl.</samp>.  If there are, remove
<samp>#cvs.lock</samp>, wait for a while, and try again.  If
there are no readers, then create a file whose name is
<samp>#cvs.wfl</samp> followed by information of your choice
(for example, hostname and process identification
number).  Hang on to the <samp>#cvs.lock</samp> lock.  Proceed
with writing the repository.  When you are done, first
remove the <samp>#cvs.wfl</samp> file and then the
<samp>#cvs.lock</samp> directory. Note that unlike the
<samp>#cvs.rfl</samp> file, the <samp>#cvs.wfl</samp> file is just
informational; it has no effect on the locking operation
beyond what is provided by holding on to the
<samp>#cvs.lock</samp> lock itself.
</p>
<p>Note that each lock (write lock or read lock) only locks
a single directory in the repository, including
<samp>Attic</samp> and <samp>CVS</samp> but not including
subdirectories which represent other directories under
version control.  To lock an entire tree, you need to
lock each directory (note that if you fail to obtain
any lock you need, you must release the whole tree
before waiting and trying again, to avoid deadlocks).
</p>
<p>Note also that <small>CVS</small> expects write locks to control
access to individual <samp>foo,v</samp> files.  <small>RCS</small> has
a scheme where the <samp>,foo,</samp> file serves as a lock,
but <small>CVS</small> does not implement it and so taking out a
<small>CVS</small> write lock is recommended.  See the comments at
rcs_internal_lockfile in the <small>CVS</small> source code for
further discussion/rationale.
</p>
<hr>
<div class="header">
<p>
Next: <a href="CVSROOT-storage.html#CVSROOT-storage" accesskey="n" rel="next">CVSROOT storage</a>, Previous: <a href="CVS-in-repository.html#CVS-in-repository" accesskey="p" rel="prev">CVS in repository</a>, Up: <a href="Repository-storage.html#Repository-storage" accesskey="u" rel="up">Repository storage</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
